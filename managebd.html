<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Добавить упражнение</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-auth.js"></script> <!-- Добавил аутентификацию -->

  <script>
    // Инициализация Firebase
    var firebaseConfig = {
      apiKey: "AIzaSyCIXtcjkj6kLTqwStdD7RtMCuiycrKBH0k",
      authDomain: "fitnessapp-f519f.firebaseapp.com",
      projectId: "fitnessapp-f519f",
      storageBucket: "fitnessapp-f519f.appspot.com",
      messagingSenderId: "1000735476286",
      appId: "1:1000735476286:web:4a62a875917834dd215f6f",
      measurementId: "G-MJ8K8ZNQM4"
    };
    firebase.initializeApp(firebaseConfig);
    var db = firebase.firestore();
    var auth = firebase.auth();

    // Функция проверки состояния аутентификации
    function checkAuthState() {
      auth.onAuthStateChanged(function(user) {
        if (user) {
          document.getElementById("user-status").textContent = "Welcome, " + user.email;
          document.getElementById("login-link").style.display = "none";
          document.getElementById("logout-btn").style.display = "inline-block";
        } else {
          document.getElementById("user-status").textContent = "Please log in";
          document.getElementById("login-link").style.display = "inline-block";
          document.getElementById("logout-btn").style.display = "none";
        }
      });
    }

    // Функция выхода из системы
    function logoutUser() {
      auth.signOut().then(function() {
        console.log("User signed out.");
      }).catch(function(error) {
        console.error("Error signing out: ", error);
      });
    }

    // Загрузка меню и проверка авторизации
    document.addEventListener("DOMContentLoaded", function () {
      fetch('menu.html')
        .then(response => response.text())
        .then(html => {
          document.getElementById("navbar-container").innerHTML = html;
          checkAuthState();
        })
        .catch(err => console.error("Ошибка загрузки меню:", err));
    });

    // Функция добавления упражнения
    function addExercise() {
      var category = document.getElementById("category").value.trim();
      var exerciseName = document.getElementById("exerciseName").value.trim();

      if (!category || !exerciseName) {
        alert("Выберите категорию и введите название упражнения!");
        return;
      }

      var exerciseData = {
        exerciseid: exerciseName,
        exercisename: exerciseName,
        exercisetype: document.getElementById("exerciseType").value.trim(),
        sets: document.getElementById("sets").value.trim(),
        reps: document.getElementById("reps").value.trim(),
        muscle: document.getElementById("muscle").value.trim(),
        muscletypeadditional: document.getElementById("muscleTypeAdditional").value.trim(),
        video: document.getElementById("videoUrl").value.trim(),
        photo: document.getElementById("photoUrl").value.trim(),
        description: document.getElementById("description").value.trim()
      };

      db.collection("workouts").doc(category).collection("exercises").doc(exerciseName).set(exerciseData)
        .then(function () {
          alert("Упражнение добавлено в " + category);
          document.getElementById("exerciseForm").reset();
        })
        .catch(function (error) {
          console.error("Ошибка при добавлении упражнения: ", error);
        });
    }
  </script>
</head>
<body>

  <!-- Контейнер для меню -->
  <div id="navbar-container"></div>

  <h1>Добавить упражнение</h1>

  <form id="exerciseForm">
    <label for="category">Категория (группа мышц):</label>
    <select id="category">
      <option value="Chest">Грудь</option>
      <option value="Biceps">Бицепс</option>
      <option value="Back">Спина</option>
      <option value="Legs">Ноги</option>
      <option value="Shoulders">Плечи</option>
      <option value="Triceps">Трицепс</option>
    </select>
    <br><br>

    <label for="exerciseName">Название упражнения:</label>
    <input type="text" id="exerciseName" required><br><br>

    <label for="exerciseType">Тип упражнения:</label>
    <input type="text" id="exerciseType"><br><br>

    <label for="sets">Количество подходов:</label>
    <input type="text" id="sets"><br><br>

    <label for="reps">Количество повторений:</label>
    <input type="text" id="reps"><br><br>

    <label for="muscle">Основная мышца:</label>
    <input type="text" id="muscle"><br><br>

    <label for="muscleTypeAdditional">Доп. мышцы:</label>
    <input type="text" id="muscleTypeAdditional"><br><br>

    <label for="videoUrl">Ссылка на видео (YouTube):</label>
    <input type="url" id="videoUrl"><br><br>

    <label for="photoUrl">Ссылка на фото:</label>
    <input type="url" id="photoUrl"><br><br>

    <label for="description">Описание упражнения:</label><br>
    <textarea id="description" rows="4" cols="40"></textarea><br><br>

    <button type="button" onclick="addExercise()">Добавить упражнение</button>
  </form>

</body>
</html>
